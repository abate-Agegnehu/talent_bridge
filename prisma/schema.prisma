generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int          @id @default(autoincrement())
  name         String
  email        String       @unique
  password     String
  role         Role
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  advisors     Advisor[]
  colleges     College[]
  companies    Company[]
  departments  Department[]
  students     Student[]
  universities University[]
  admin     Admin[]
  sentMessages     Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
}

model Admin {
  id       Int       @id @default(autoincrement())
  userId   Int
  user     User      @relation(fields: [userId], references: [id])
}

enum RegistrationStatus{
  PENDING
  ACCEPTED
  REJECTED
}

model University {
  id       Int       @id @default(autoincrement())
  userId   Int
  status  RegistrationStatus  @default(PENDING)
  colleges College[]
  user     User      @relation(fields: [userId], references: [id])
}

model College {
  id           Int          @id @default(autoincrement())
  universityId Int
  userId       Int
  status  RegistrationStatus  @default(PENDING)
  university   University   @relation(fields: [universityId], references: [id])
  user         User         @relation(fields: [userId], references: [id])
  departments  Department[]
}

model Department {
  id        Int       @id @default(autoincrement())
  collegeId Int
  userId    Int
  advisors  Advisor[]
  college   College   @relation(fields: [collegeId], references: [id])
  user      User      @relation(fields: [userId], references: [id])
  students  Student[]
  internshipAcceptances InternshipAcceptance[]
}

enum AdvisorStatus {
  PENDING    
  APPROVED   
  REJECTED   
}


model Advisor {
  id           Int        @id @default(autoincrement())
  departmentId Int
  userId       Int
  status        AdvisorStatus  @default(PENDING)
  department   Department @relation(fields: [departmentId], references: [id])
  user         User       @relation(fields: [userId], references: [id])
  assignments  AdvisorAssignment[]
}

model Student {
  id           Int         @id @default(autoincrement())
  year         Int
  universityId Int?
  collegeId    Int?
  departmentId Int?
  userId       Int
  department   Department? @relation(fields: [departmentId], references: [id])
  user         User        @relation(fields: [userId], references: [id])
  applications InternshipApplication[]
  advisors     AdvisorAssignment[]
  internshipAcceptances InternshipAcceptance[]
  testProjects TestProject[]
}

model Company {
  id        Int      @id @default(autoincrement())
  userId    Int
  status    RegistrationStatus @default(PENDING)
  user      User     @relation(fields: [userId], references: [id])
  internships Internship[]
  internshipAcceptances InternshipAcceptance[]
  testProjects TestProject[]
}

enum InternshipType {
  REMOTE
  ONSITE
  HYBRID
}

enum InternshipStatus {
  OPEN
  CLOSED
  FILLED
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model Internship {
  id            Int       @id @default(autoincrement())

  // Relations
  companyId     Int
  company       Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  // Core internship info
  title         String
  description   String
  requirements  String?
  responsibilities String?
  location      String
  type          InternshipType  
  duration      String           // e.g. "3 Months", "6 Months"
  stipend       Float?

  
  applicationDeadline DateTime
  status        InternshipStatus @default(OPEN)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  applications  InternshipApplication[]
  internshipAcceptances InternshipAcceptance[]
  testProjects TestProject[]
}


model InternshipApplication {
  id            Int       @id @default(autoincrement())
  internshipId  Int
  studentId     Int
  coverLetter   String
  resumeUrl     String?
  portfolioUrl  String?
  status        ApplicationStatus @default(PENDING)
  appliedAt     DateTime  @default(now())

  internship    Internship @relation(fields: [internshipId], references: [id], onDelete: Cascade)
  student       Student    @relation(fields: [studentId], references: [id], onDelete: Cascade)
}




enum Role {
  UNIVERSITY
  COMPANY
  COLLEGE
  DEPARTMENT
  ADVISOR
  STUDENT
  ADMIN
}


model Message {
  id          String   @id @default(uuid())
  senderId    Int
  receiverId  Int

  // Message content
  messageType MessageType @default(TEXT)
  text        String?      // nullable for file-only messages

  // File support
  fileUrl     String?      // stored file URL (S3, Cloudinary, local, etc.)
  fileName    String?
  fileType    String?      // pdf, image/png, video/mp4, etc.
  fileSize    Int?         // in bytes

  isRead      Boolean  @default(false)

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  sender    User      @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver  User      @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
}

enum MessageType {
  TEXT
  FILE
  TEXT_AND_FILE
}

enum AdvisorAssignmentStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

model AdvisorAssignment {
  id         Int      @id @default(autoincrement())
  advisorId  Int
  studentId  Int
  status     AdvisorAssignmentStatus @default(ACTIVE)
  assignedAt DateTime @default(now())

  advisor    Advisor  @relation(fields: [advisorId], references: [id], onDelete: Cascade)
  student    Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([advisorId, studentId]) // prevent duplicate assignment
}


model InternshipAcceptance {
  id            Int      @id @default(autoincrement())
  letter     String

  internshipId  Int
  companyId     Int
  studentId     Int
  departmentId  Int?

  internship    Internship @relation(fields: [internshipId], references: [id], onDelete: Cascade)
  company       Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  student       Student    @relation(fields: [studentId], references: [id], onDelete: Cascade)
  department    Department? @relation(fields: [departmentId], references: [id])

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  @@unique([internshipId, studentId]) // one acceptance per internship per student
}

model TestProject {
  id            Int      @id @default(autoincrement())
  description     String
  projectUrl  String?

  internshipId  Int
  companyId     Int
  studentId     Int

  internship    Internship @relation(fields: [internshipId], references: [id], onDelete: Cascade)
  company       Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  student       Student    @relation(fields: [studentId], references: [id], onDelete: Cascade)

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  @@unique([internshipId, studentId]) // one test project per internship per student
}
